# Fichier stress-load.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  # Nom ajusté pour correspondre à la fonction de nettoyage du script Bash
  name: stress-load 
spec:
  # Maintenir 3 réplicas
  replicas: 3 
  selector:
    matchLabels:
      app: stress-test
  template:
    metadata:
      labels:
        app: stress-test
    spec:
      # Affinité pour forcer le placement sur le nœud 'low-latency'
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: low-latency
                operator: Exists
      containers:
      - name: stress-container
        image: busybox
        # La commande: Lance une boucle infinie pour simuler une charge CPU intense
        command: ["/bin/sh", "-c"]
        args: ["i=0; while true; do i=i+1; done"] 
        resources:
          # Demande 800m CPU par réplica. Charge totale demandée: 3 * 0.8 = 2.4 CPU.
          requests:
            cpu: "800m"
          limits:
            cpu: "800m"